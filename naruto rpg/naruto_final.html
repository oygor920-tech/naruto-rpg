<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Naruto RPG: High Score Edition</title>
    <style>
        :root { --laranja: #ff6600; --azul: #00e1ff; --vermelho: #ff0000; --ouro: #ffd700; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Arial Black', sans-serif; }

        #viewport { width: 100vw; height: 100vh; position: relative; overflow: hidden; }
        #world { position: absolute; width: 4000px; height: 4000px; background-image: url('mapa_naruto.png'); background-size: 1000px; }

        /* Personagens */
        .sprite { width: 64px; height: 64px; position: absolute; background-size: 512px 512px; image-rendering: pixelated; z-index: 50; }
        #player { background-image: url('naruto.png'); }
        #boss { background-image: url('naruto.png'); filter: hue-rotate(150deg) brightness(0.6); transform: scale(1.6); transition: filter 0.1s; }

        /* VFX */
        .rasengan { width: 45px; height: 45px; background: radial-gradient(circle, #fff, var(--azul)); border-radius: 50%; position: absolute; z-index: 60; box-shadow: 0 0 30px var(--azul); }
        .fumaca { position: absolute; width: 64px; height: 64px; background: #fff; border-radius: 50%; opacity: 0.6; z-index: 100; animation: puff 0.4s forwards; }
        @keyframes puff { to { transform: scale(2.5); opacity: 0; } }
        .dano-flash { filter: brightness(10) !important; }

        /* HUD Profissional */
        #hud { position: absolute; top: 20px; left: 20px; z-index: 1000; background: rgba(0,0,0,0.85); padding: 15px; border-radius: 12px; border-left: 8px solid var(--laranja); color: white; }
        #timer-hud { position: absolute; top: 20px; right: 20px; z-index: 1000; background: rgba(0,0,0,0.85); padding: 15px; border-radius: 12px; border: 2px solid var(--azul); color: var(--azul); font-size: 24px; }
        .barra { width: 200px; height: 10px; background: #333; margin: 8px 0; border-radius: 5px; overflow: hidden; }
        #hp-fill { width: 100%; height: 100%; background: var(--vermelho); }
        #chakra-fill { width: 0%; height: 100%; background: var(--azul); }

        /* Tela Final */
        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 2000; color: white; text-align: center; }
        .btn { padding: 15px 40px; background: var(--laranja); border: none; color: white; border-radius: 30px; cursor: pointer; font-weight: bold; font-size: 20px; margin-top: 20px; }
    </style>
</head>
<body>

<div id="viewport">
    <div id="hud">
        <div style="font-size: 14px; opacity: 0.8;">RECORDE: <span id="best-txt">--</span>s</div>
        <div class="barra"><div id="hp-fill"></div></div>
        <div class="barra"><div id="chakra-fill"></div></div>
        <div style="font-size: 10px;">[C] CHAKRA | [ESPAÇO] JUTSU | [SHIFT] DASH</div>
    </div>

    <div id="timer-hud"><span id="curr-timer">0.0</span>s</div>

    <div id="overlay">
        <h1 id="status-title">VITÓRIA!</h1>
        <p id="final-stats" style="font-size: 24px;"></p>
        <button class="btn" onclick="location.reload()">RECOMECAR</button>
    </div>

    <div id="world">
        <div id="player" class="sprite"></div>
        <div id="boss" class="sprite" style="top: 1000px; left: 1000px;">
             <div style="width:80px; height:6px; background:#000; position:absolute; top:-20px;"><div id="boss-hp" style="width:100%; height:100%; background:red;"></div></div>
        </div>
    </div>
</div>

<script>
    const player = document.getElementById('player');
    const world = document.getElementById('world');
    const hpFill = document.getElementById('hp-fill');
    const chakraFill = document.getElementById('chakra-fill');
    const bossHP = document.getElementById('boss-hp');
    const timerTxt = document.getElementById('curr-timer');
    const bestTxt = document.getElementById('best-txt');

    let pX = 500, pY = 500, hp = 100, chakra = 0;
    let bX = 1200, bY = 1200, bHP = 100, bAtivo = true;
    let keys = {}, frame = 0, timerAnim = 0, jogoAtivo = true, tempo = 0;

    // Carregar Recorde do Navegador
    let recorde = localStorage.getItem('naruto_record') || Infinity;
    bestTxt.innerText = recorde === Infinity ? "--" : recorde;

    // Cronômetro de precisão
    const clock = setInterval(() => {
        if(jogoAtivo) { tempo += 0.1; timerTxt.innerText = tempo.toFixed(1); }
    }, 100);

    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => { keys[e.code] = false; player.style.backgroundPosition = "0px 0px"; });

    function disparar() {
        if(chakra >= 20 && jogoAtivo) {
            chakra -= 20; chakraFill.style.width = chakra + "%";
            let r = document.createElement('div');
            r.className = 'rasengan';
            r.style.left = pX + "px"; r.style.top = pY + "px";
            world.appendChild(r);

            let rx = pX, ry = pY;
            let moveR = setInterval(() => {
                rx += (bX > rx) ? 18 : -18; ry += (bY > ry) ? 18 : -18;
                r.style.left = rx + "px"; r.style.top = ry + "px";
                if(Math.hypot(rx - bX, ry - bY) < 60 && bAtivo) {
                    bHP -= 20; bossHP.style.width = bHP + "%";
                    bX += (bX - pX) * 0.4; bY += (bY - pY) * 0.4; // Knockback
                    boss.classList.add('dano-flash');
                    setTimeout(() => boss.classList.remove('dano-flash'), 100);
                    r.remove(); clearInterval(moveR);
                    if(bHP <= 0) finalizar(true);
                }
            }, 30);
        }
    }

    window.addEventListener('keydown', e => {
        if(e.code === 'Space') disparar();
        if(e.code === 'ShiftLeft') { pX += (keys['KeyD'] ? 150 : keys['KeyA'] ? -150 : 0); pY += (keys['KeyS'] ? 150 : keys['KeyW'] ? -150 : 0); }
    });

    function finalizar(vitoria) {
        jogoAtivo = false;
        clearInterval(clock);
        document.getElementById('overlay').style.display = 'flex';
        let stats = document.getElementById('final-stats');
        
        if(vitoria) {
            let finalTempo = tempo.toFixed(1);
            let msg = `Tempo final: ${finalTempo}s`;
            if(finalTempo < recorde) {
                localStorage.setItem('naruto_record', finalTempo);
                msg = `<span style="color:var(--ouro)">NOVO RECORDE: ${finalTempo}s!</span>`;
            }
            stats.innerHTML = msg;
        } else {
            document.getElementById('status-title').innerText = "GAME OVER";
            document.getElementById('status-title').style.color = "red";
            stats.innerText = "Você não resistiu ao ataque inimigo.";
        }
    }

    function gameLoop() {
        if(!jogoAtivo) return;

        let vel = 9, mx = 0, my = 0;
        if (keys['KeyW'] || keys['ArrowUp']) my = -vel;
        if (keys['KeyS'] || keys['ArrowDown']) my = vel;
        if (keys['KeyA'] || keys['ArrowLeft']) mx = -vel;
        if (keys['KeyD'] || keys['ArrowRight']) mx = vel;

        if(pX + mx > 0 && pX + mx < 3940) pX += mx;
        if(pY + my > 0 && pY + my < 3940) pY += my;

        if(mx !== 0 || my !== 0) {
            timerAnim++;
            if(timerAnim > 5) { frame = (frame + 1) % 4; timerAnim = 0; }
            player.style.backgroundPosition = `${frame*-64}px 0px`;
        }

        if(keys['KeyC']) {
            chakra = Math.min(100, chakra + 1);
            chakraFill.style.width = chakra + "%";
            player.style.filter = "brightness(1.8)";
        } else { player.style.filter = "none"; }

        if(bAtivo) {
            let dx = pX - bX, dy = pY - bY, dist = Math.hypot(dx, dy);
            if(dist < 1000) { bX += (dx/dist)*4.5; bY += (dy/dist)*4.5; }
            if(dist < 45) { hp -= 0.6; hpFill.style.width = hp + "%"; if(hp <= 0) finalizar(false); }
            boss.style.left = bX + "px"; boss.style.top = bY + "px";
        }

        let cx = (window.innerWidth/2) - pX - 32;
        let cy = (window.innerHeight/2) - pY - 32;
        player.style.left = pX + "px"; player.style.top = pY + "px";
        world.style.transform = `translate(${cx}px, ${cy}px)`;

        requestAnimationFrame(gameLoop);
    }
    gameLoop();
</script>
</body>
</html>